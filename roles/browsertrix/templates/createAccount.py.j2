#!/usr/bin/python3
import json
import requests

email = "{{ browsertrix_user_email }}"
password = "{{ browsertrix_user_password }}"


URL = "https://browsertrix.prod.starlinglab.org/api/auth/register"
body = {
    "email": email,
    "password": password,
    "name": "Integrity Account",
    "newArchive": True,
    "newArchiveName": "Integrity Archive",
}
response = requests.post(URL, json=body)

# AUTH
auth = {"username": email, "password": password}
URL = "http://127.0.0.1:9871/api/auth/jwt/login"
access_token = ""
resp = requests.post(URL, data=auth)
response_json = resp.json()
if "access_token" not in response_json:
    raise Exception("Access Token Failed")
access_token = response_json["access_token"]
headers = {"Authorization": "Bearer " + access_token}

# get AID
URL = "http://127.0.0.1:9871/api/archives"
r = requests.get(URL, headers=headers)
res = r.json()
print(res["archives"][0]["id"])